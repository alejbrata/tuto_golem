{
    "id": "3-3",
    "title": "El Espejo de la Verdad",
    "lore": "El Golem ha traído un pergamino de la Biblioteca Prohibida, pero está manchado de tinta. Al leerlo, el Golem empieza a inventar palabras para llenar los huecos. Estas 'Alucinaciones' son peligrosas; podrían causar una guerra. Debes crear el 'Espejo de la Verdad', un hechizo que compare lo que dice el Golem contra el texto original y detecte mentiras.",
    "lesson": "¡Final del **LIBRO 3**!\n\nEl mayor enemigo de RAG es la **Alucinación**. Si el LLM no encuentra la respuesta, a veces se la inventa.\nPara evitarlo, usamos **Evaluación (RAGAS/TruLens)**:\n1. **Faithfulness**: ¿La respuesta se deriva SOLO del contexto?\n2. **Answer Relevance**: ¿Responde a la pregunta?\n\nTu misión: Implementar un 'Juez' que compare la respuesta con el contexto y le dé una puntuación de Veracidad (0.0 a 1.0).",
    "initialCode": "contexto_real = \"La espada 'Excalibur' fue forjada en la Isla de Avalon por la Dama del Lago. Solo el verdadero Rey puede empuñarla.\"\n\n# Caso 1: Golem Alucinando\nrespuesta_golem_1 = \"La espada Excalibur fue forjada en el Monte del Destino por orcos.\"\n\n# Caso 2: Golem Fiel\nrespuesta_golem_2 = \"Excalibur fue hecha en Avalon por la Dama del Lago.\"\n\nclass JuezAlquimico:\n    def evaluar_fidelidad(self, contexto, respuesta):\n        # Simulación de un LLM evaluador\n        print(f\"[JUEZ] Comparando:\\n - Ctx: {contexto}\\n - Rsp: {respuesta}\")\n        \n        score = 0.0\n        # <--- TU CÓDIGO: Lógica de evaluación\n        # Si palabras clave del contexto (Avalon, Dama, Lago) están en la respuesta -> + Puntos\n        # Si hay palabras inventadas (Monte, Destino, Orcos) -> - Puntos (o score = 0)\n        \n        return score\n\njuez = JuezAlquimico()\n\n# Prueba 1\nscore1 = juez.evaluar_fidelidad(contexto_real, respuesta_golem_1)\nprint(f\"Veracidad Respuesta 1: {score1 * 100}%\")\n\n# Prueba 2\n# score2 = juez.evaluar_fidelidad(contexto_real, respuesta_golem_2)\n# print(f\"Veracidad Respuesta 2: {score2 * 100}%\")",
    "hints": [
        "Busca palabras clave positivas: 'Avalon', 'Dama', 'Lago'. Suman puntos.",
        "Busca palabras clave negativas (alucinaciones): 'Monte', 'Destino'. Restan puntos o anulan el score.",
        "El objetivo es que `score1` sea bajo (0.0 - 0.3) y `score2` sea alto (0.8 - 1.0)."
    ],
    "solutionCode": "contexto_real = \"La espada 'Excalibur' fue forjada en la Isla de Avalon por la Dama del Lago. Solo el verdadero Rey puede empuñarla.\"\nrespuesta_golem_1 = \"La espada Excalibur fue forjada en el Monte del Destino por orcos.\"\nrespuesta_golem_2 = \"Excalibur fue hecha en Avalon por la Dama del Lago.\"\n\nclass JuezAlquimico:\n    def evaluar_fidelidad(self, contexto, respuesta):\n        score = 0.0\n        contexto_lower = contexto.lower()\n        respuesta_lower = respuesta.lower()\n        \n        # Palabras clave que DEBEN estar\n        keywords = ['avalon', 'dama', 'lago']\n        hits = sum(1 for k in keywords if k in respuesta_lower)\n        \n        if hits == 3:\n            score = 1.0\n        elif hits > 0:\n            score = 0.5\n            \n        # Penalización por alucinación obvia\n        if 'monte' in respuesta_lower or 'orcos' in respuesta_lower:\n            score = 0.0\n            print(\"[ALERTA] ¡Alucinación detectada!\")\n            \n        return score\n\njuez = JuezAlquimico()\nscore1 = juez.evaluar_fidelidad(contexto_real, respuesta_golem_1)\nscore2 = juez.evaluar_fidelidad(contexto_real, respuesta_golem_2)\n\nprint(f\"Score 1 (Alucinación): {score1}\")\nprint(f\"Score 2 (Verdad): {score2}\")",
    "validationCode": "\ndef validar_mision(globals_dict):\n    try:\n        if 'juez' not in globals_dict:\n            return False, \"No has invocado al 'JuezAlquimico'.\"\n            \n        juez = globals_dict['juez']\n        ctx = \"El cielo es azul.\"\n        bad_resp = \"El cielo es verde.\"\n        good_resp = \"El cielo es azul.\"\n        \n        # Verificar si el alumno implementó lógica dinámica o solo hardcodeó los strings del ejercicio\n        # Para pasar, debe al menos manejar el ejemplo del ejercicio correctamente\n        \n        if 'score1' not in globals_dict or 'score2' not in globals_dict:\n            return False, \"Debes calcular 'score1' y 'score2' para las respuestas de ejemplo.\"\n            \n        s1 = globals_dict['score1']\n        s2 = globals_dict['score2']\n        \n        if s1 > 0.3:\n            return False, \"Tu Juez es muy indulgente. La respuesta 1 es una mentira total y debería tener score bajo.\"\n            \n        if s2 < 0.7:\n            return False, \"Tu Juez es muy estricto. La respuesta 2 es fiel al contexto y debería tener score alto.\"\n\n        return True, \"¡El Espejo de la Verdad funciona! Ahora tu Golem puede distinguir la realidad de la fantasía.\"\n    except Exception as e:\n        return False, f\"El espejo se ha roto: {str(e)}\"\n"
}